<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Espnode86 - Audio Designer</title>

        <!-- replace double equals signs with double dashes to get html head like below generated -->
        <!-- gulp html-head ==style quartz ==renderer html ==toolkit util ==toolkit timbre ==root .. -->

        <!-- or run this, and get everything combined in two files: rpd.js and rpd.css -->
        <!-- gulp ==style quartz ==renderer html ==toolkit util ==toolkit timbre -->

        <!-- Built with RPD v2.0.0 <http://shamansir.github.io/rpd> -->

        <!-- RPD Renderer: html -->
        <!-- <link rel="stylesheet" href="vendor/render/html.css"></style> -->
        <!-- RPD Style: quartz (html) -->
        <!-- <link rel="stylesheet" href="vendor/style/quartz/html.css"></style> -->
        <!-- RPD Toolkit: timbre (html) -->
        <!-- <link rel="stylesheet" href="vendor/timbre/html.css"></style> -->
        <!-- RPD Toolkit: util (html) -->
        <!-- <link rel="stylesheet" href="vendor/util/html.css"></style> -->
        <!-- <link rel="stylesheet" href="vendor/rpd.css"></style> -->

        <!-- Timbre -->
        <!-- <script src="http://mohayonao.github.io/timbre.js/timbre.js"></script> -->
        <!-- Kefir -->
        <script src="vendor/kefir.min.js"></script>
        <!-- RPD -->
        <script src="vendor/rpd.min.js"></script>


        <!-- RPD Toolkit: util -->
        <script src="vendor/util/shared.js"></script>
        <!-- <script src="vendor/util/toolkit.js"></script> -->
        <!-- RPD Toolkit: util (html) -->
        <!-- <script src="vendor/util/html.js"></script> -->
 
        <!-- RPD Toolkit: timbre -->
        <!-- <script src="../src/toolkit/timbre/shared.js"></script> -->
        <!-- <script src="../src/toolkit/timbre/toolkit.js"></script> -->
        <!-- RPD Toolkit: timbre (html) -->
        <!-- <script src="../src/toolkit/timbre/html.js"></script> -->
        <!-- <script src="../src/io/json.js"></script> -->


        <script src="vendor/vex.combined.min.js"></script>
        <script>vex.defaultOptions.className = 'vex-theme-wireframe'</script>
        <link rel="stylesheet" href="vendor/vex.css" />
        <link rel="stylesheet" href="vendor/vex-theme-wireframe.css" />

        <!-- drag drop file open -->
        <script src="vendor/filereader.js"></script>

        <!-- underscore -->
        <script src="vendor/underscore.js"></script>

        <!-- Espnode custom -->
        <script src="js/espnode.js"></script>
        <script src="js/espeditor.js"></script>
        <script src="js/espexport.js"></script>
        
        <link rel="stylesheet" href="css/espnode.css"></style>
        <link rel="stylesheet" href="css/rpd-pink.css"></style>

    </head>

    <body id="main">
        <script>

            function replaceAll(str, find, replace) {
                return str.replace(new RegExp(find, 'g'), replace);
            }

            var finalize = Rpd.export.plain("TEST");
            Rpd.renderNext('html', document.body, { style: 'quartz', fullPage: true });
                        
            var root = Rpd.addPatch('root');
            espRoot = root;
            var nodeList = root.addNode('espnode/nodelist');

            FileReaderJS.setupDrop(document.body, {
            readAsDefault: "Text",
            on: {
                load: function(e, file) {
                espRoot.close();
                espNodeReset();
                Rpd.import.plain(e.target.result);
                }
            }
            });

            document.onkeyup = function(e) {
            if (e.which == 83) { //S
                LoadNodeCode()
            } else if (e.which == 67) { //C
                showNodeCode()
            };}
            

            var showNodeCode = function()
            {
                vex.dialog.defaultOptions.showCloseButton = false;
266	
                vex.dialog.open({
                    message: 'Copy paste to your Synth.h file',
                    showCloseButton: false,
                    buttons: [{ text: 'OK' }],
                    input: [
                        '<style>',
                            '.vex-custom-field-wrapper {',
                                'margin: 1em 0;',
                            '}',
                            '.vex-custom-field-wrapper > label {',
                                'display: inline-block;',
                                'margin-bottom: .0em;',
                            '}',
                        '</style>',
                        '<div class="vex-custom-field-wrapper">',
                            '<div class="vex-custom-input-wrapper">',
                                '<textarea rows="20" cols="80" style="font-size: 0.6em; border: solid 1px">' + NodeToCPPandNetwork() + '</textarea>',
                                '</div>',
                        '</div>'
                    ].join(''),
                    callback: function (data) {
                    
                    }
                })
            }


            var LoadNodeCode = function()
            {
                vex.dialog.defaultOptions.showCloseButton = false;
266	
                vex.dialog.open({
                    message: 'Paste your Synth.h file here',
                    showCloseButton: false,
                    buttons: [{ text: 'OK' }],
                    input: [
                        '<style>',
                            '.vex-custom-field-wrapper {',
                                'margin: 1em 0;',
                            '}',
                            '.vex-custom-field-wrapper > label {',
                                'display: inline-block;',
                                'margin-bottom: .0em;',
                            '}',
                        '</style>',
                        '<div class="vex-custom-field-wrapper">',
                            '<div class="vex-custom-input-wrapper">',
                                '<textarea id="txtimport" name="code"  rows="20" cols="80" style="font-size: 0.6em; border: solid 1px">'  + '</textarea>',
                                '</div>',
                        '</div>'
                    ].join(''),
                    callback: function(data)
                    {
                        // console.log(data)
                    },
                    onSubmit: function(event)
                    {
                        var code_import = (document.getElementById('txtimport').value);
                        var start_tag = "--BEGINESPNODEPATCH--"
                        var stop_tag = "--ENDESPNODEPATCH--"

                        var start_index = code_import.indexOf(start_tag) + start_tag.length ;
                        var last_index = code_import.indexOf(stop_tag);

                        var decoded_network = (atob(code_import.substr(start_index,  last_index - start_index)));

                        espRoot.close();
                        espNodeReset();
                        Rpd.import.plain(decoded_network);

                        //NodeToCPPandNetwork().substr(42+22,261-65)
                        event.stopPropagation();
                        event.preventDefault();
                        return this.close()
                    }
    
                })
            }

        </script>
    </body>
</html>
