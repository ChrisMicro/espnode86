/**
 * rpd - RPD is a minimal framework for building Node-Based User Interfaces, powered by Reactive Programming
 * Built at Fri, 13 Jul 2018 06:26:38 GMT
 *
 * @version v2.1.3
 * @link http://shamansir.github.io/rpd
 * @author Ulric Wilfred <shaman.sir@gmail.com> (http://shamansir.github.io)
 * @license MIT
 * 
 * Selected Renderers: html
 * Selected Styles: quartz
 * Selected Toolkits: [None]
 * Selected I/O Modules: [None]
 * Selected Navigation Modules: [None]
 * d3.js or d3_tiny.js: d3_tiny.js
 *
 * User Styles: [None]
 * User Toolkits: [None]
 *
 * Command: gulp --renderer html --style quartz --target-name rpd --compilation simple
 */
(function(m){var b=m.Kefir;"undefined"===typeof b&&"undefined"!==typeof require&&(b=require("kefir"));if(!b)throw Error("Kefir.js (https://github.com/rpominov/kefir) is required for Rpd to work");var f=function(){function z(a){return function(){return a}}function q(){var a=b.emitter();a.map(function(a){return{rule:a,func:function(n){n.render(a.aliases,a.targets,a.config)}}}).scan(function(a,n){a&&B["network/add-patch"].offValue(a.func);B["network/add-patch"].onValue(n.func);return n},null).last().onValue(function(a){B["network/add-patch"].offValue(a.func)});
return a}function k(a,c){var n=d(a)?void 0:a,n=new l(n,c||a);B["network/add-patch"].emit(n);return n}function l(a,c){this.id=C();this.name=a;this.def=c||{};var n=this,d={"patch/is-ready":[],"patch/open":["parent"],"patch/close":[],"patch/move-canvas":["position"],"patch/resize-canvas":["size"],"patch/set-inputs":["inputs"],"patch/set-outputs":["outputs"],"patch/project":["node","target"],"patch/refer":["node","target"],"patch/add-node":["node"],"patch/remove-node":["node"]};this.event=F(d);this.events=
A(d,this.event,"patch",this);this.def.handle&&J(this.events,this.def.handle);this.renderQueue=b.emitter();d=b.combine([this.events],[this.renderQueue.scan(function(a,c){var v=c.alias,d=c.target,g=c.config,e=a[v];e||(e={},e.produce=S[v](n),e.handlers=[],a[v]=e);if(e.produce){var f=e.produce(d,g);f&&e.handlers.push("function"===typeof f?f:function(a){if(f[a.type])f[a.type](a)})}return a},{})]);d=d.bufferBy(this.renderQueue).take(1).flatten().concat(d);d.onValue(function(a){var n=a[0];a=a[1];for(var c=
Object.keys(a),v,d=0,g=c.length;d<g;d++){v=a[c[d]];v=v.handlers;for(var e=0,f=v.length;e<f;e++)v[e](ba(M(n),c[d]))}});this.projections=b.emitter();b.combine([this.projections],[this.event["patch/set-inputs"],this.event["patch/set-outputs"]]).onValue(function(a){var c=a[0],v=a[1];a=a[2];for(var d,g=0;g<v.length;g++)d=c.addInlet(v[g].type,v[g].alias,v[g].def,v[g].render),d.event["inlet/update"].onValue(function(a){return function(c){a.receive(c)}}(v[g]));for(g=0;g<a.length;g++)v=c.addOutlet(a[g].type,
a[g].alias,a[g].def,a[g].render),a[g].event["outlet/update"].onValue(function(a){return function(c){a.send(c)}}(v));n.event["patch/project"].emit({node:c,target:c.patch});c.patch.event["patch/refer"].emit({node:c,target:n})});this.nodesToRemove=b.emitter();this.event["patch/is-ready"].emit()}function h(a,c,n,d,e){this.type=a||"core/basic";this.toolkit=T(a);this.id=C();this.patch=c;a={"node/turn-on":[],"node/is-ready":[],"node/process":["inlets","outlets"],"node/turn-off":[],"node/add-inlet":["inlet"],
"node/remove-inlet":["inlet"],"node/add-outlet":["outlet"],"node/remove-outlet":["outlet"],"node/move":["position"],"node/configure":["props"]};this.event=F(a);this.events=A(a,this.event,"node",this);(a=G(u[this.type],this))||y(this,"node","Node type '"+this.type+"' is not registered!");this.def=m(w,n,a);this.render=Q(ca,d,H(g[this.type],this));e&&e(this);var f=this;this.def.handle&&J(this.events,this.def.handle);if(this.def.process){var h=this.def.process;n=b.combine([this.event["node/add-inlet"].flatMap(function(a){var c=
a.event["inlet/update"].map(function(c){return{inlet:a,value:c}});f.def.tune&&(c=f.def.tune.bind(f)(c));return c})],[this.event["node/add-outlet"].scan(function(a,c){a[c.alias]=c;return a},{})]);n=n.bufferBy(this.event["node/is-ready"]).take(1).flatten().concat(n);n=n.scan(function(a,c){var n=c[0].inlet,v=n.alias;a.inlets.prev[v]=a.inlets.cur[v];a.inlets.cur[v]=c[0].value;a.outlets=c[1];a.source=n;return a},{inlets:{prev:{},cur:{}},outlets:{}}).changes();n=n.filter(function(a){return!a.source.def.cold});
n.onValue(function(a){var c=h.bind(f)(a.inlets.cur,a.inlets.prev);f.event["node/process"].emit({inlets:a.inlets.cur,outlets:c});a=a.outlets;for(var n in c)a[n]&&(c[n]instanceof b.Stream?a[n].stream(c[n]):a[n].send(c[n]))})}if(this.def.inlets){this.inlets={};for(var t in this.def.inlets)n=this.def.inlets[t],n=this.addInlet(n.type,t,n),this.inlets[t]=n}if(this.def.outlets)for(t in this.outlets={},this.def.outlets)n=this.def.outlets[t],n=this.addOutlet(n.type,t,n),this.outlets[t]=n;this.def.prepare&&
this.def.prepare.bind(this)(this.inlets,this.outlets);this.event["node/is-ready"].emit()}function p(a,c,n,d,g){this.type=a||"core/any";this.toolkit=T(a);this.id=C();this.alias=n;this.node=c;(a=G(E[this.type],this))||y(this,"inlet","Channel type '"+this.type+"' is not registered!");this.def=m(R,d,a);this.alias||L(this,"inlet","Inlet should have an alias");this.value=b.pool();this.render=Q(W,g,H(D[this.type],this));d={"inlet/update":["value"]};this.event=F(d);var e=this.event["inlet/update"];g=e.merge(this.value);
this.def.tune&&(g=this.def.tune.bind(this)(g));this.def.accept&&(g=g.flatten(function(a){if(this.def.accept(a))return[a];e.error({type:"inlet/error",system:!1,subject:this,message:null,silent:!0});return[]}.bind(this)));this.def.adapt&&(g=g.map(this.def.adapt));this.event["inlet/update"]=g.onValue(function(){});this.events=A(d,this.event,"inlet",this);this.def.handle&&J(this.events,this.def.handle)}function r(a,v,n,d,g){this.type=a||"core/any";this.toolkit=T(a);this.id=C();this.alias=n;this.node=
v;(a=G(E[this.type],this))||y(this,"outlet","Channel type '"+this.type+"' is not registered!");this.def=m(c,d,a);this.alias||L(this,"outlet","Outlet should have an alias");this.value=b.pool();this.render=Q(W,g,H(D[this.type],this));d={"outlet/update":["value"],"outlet/connect":["link","inlet"],"outlet/disconnect":["link"]};this.event=F(d);g=this.event["outlet/update"].merge(this.value);this.event["outlet/update"]=g.onValue(function(a){});this.events=A(d,this.event,"outlet",this);this.def.handle&&
J(this.events,this.def.handle);var e=this;b.combine([this.event["outlet/connect"]],[this.event["outlet/update"]]).onValue(function(a){e.value.plug(b.constant(a[1]))})}function e(a,c,n){this.id=C();this.name=n||"";this.outlet=a;this.inlet=c;this.value=b.emitter();var d=this;this.receiver=a.node.id!==c.node.id?function(a){d.pass(a)}:function(a){setTimeout(function(){d.pass(a)},0)};a={"link/enable":[],"link/disable":[],"link/pass":["value"]};this.event=F(a);n=this.event["link/pass"].merge(this.value);
this.event["link/pass"]=n.onValue(function(a){});this.events=A(a,this.event,"link",this);this.enabled=b.merge([this.event["link/disable"].map(z(!1)),this.event["link/enable"].map(z(!0))]).toProperty(z(!0));this.event["link/pass"].filterBy(this.enabled).onValue(function(a){c.receive(a)});b.combine([this.event["link/enable"]],[this.event["link/pass"]]).onValue(function(a){d.pass(a[1])})}function m(a,c,n){var d={};c=c||{};n=n||{};for(var g,e=0,f=a.length;e<f;e++)if(g=a[e],"*"!==g[0]){if(g in c||g in
n)d[g]=t(c[g])?c[g]:n[g]}else if(g=g.slice(1),g in c||g in n){d[g]={};for(var h=n[g]?Object.keys(n[g]):[],b=0,D=h.length;b<D;b++)d[g][h[b]]=n[g][h[b]];h=c[g]?Object.keys(c[g]):[];b=0;for(D=h.length;b<D;b++)d[g][h[b]]=c[g][h[b]]}return d}function M(a){for(var c={},g=Object.keys(a),d=0,e=g.length;d<e;d++)c[g[d]]=a[g[d]];return c}function d(a){return"object"===typeof a}function t(a){return"undefined"!==typeof a}function G(a,c){return a?"function"===typeof a?a(c):a:null}function H(a,c){if(!a)return{};
var g={},d;for(d in a)g[d]=G(a[d],c);return g}function Q(a,c,g){if(!c)return g;var d={},e;for(e in g)d[e]=m(a,c[e],g[e]);for(e in c)d[e]||g[e]||(d[e]=c[e]);return d}function F(a){var c={};a=Object.keys(a);for(var g=0,d;g<a.length;g++)d=a[g],c[d]=b.emitter();return c}function N(a,c){if(0===c.length)return function(){return{type:a}};if(1===c.length)return function(g){var d={};d.type=a;d[c[0]]=g;return d};if(1<c.length)return function(c){c=M(c);c.type=a;return c}}function A(a,c,g,d){for(var e=b.pool(),
f=Object.keys(a),h=0;h<f.length;h++)e.plug(c[f[h]].map(N(f[h],a[f[h]])).map(function(a){a[g]=d;return a}));return e}function J(a,c){a.filter(function(a){return c[a.type]}).onValue(function(a){c[a.type](a)})}function L(a,c,g,d){U.plug(b.constantError({type:c+"/error",system:d||!1,subject:a,message:g,silent:!1}))}function y(a,c,g){L(a,c,g,!0)}function C(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function ba(a,c){var g=a.type;if("patch/add-node"===g||"node/process"===g)a.render=
a.node.render[c]||{};else if("node/add-inlet"===g||"inlet/update"===g)a.render=a.inlet.render[c]||{};else if("node/add-outlet"===g||"outlet/update"===g)a.render=a.outlet.render[c]||{};return a}function T(a){var c=a.indexOf("/");return 0<=c?a.substring(0,c):""}function V(a,c){u[a]=c||{}}function x(a,c){E[a]=c||{}}(function(){b.emitter=function(){var a,c=b.stream(function(c){a=c;return function(){a=void 0}});c.emit=function(c){a&&a.emit(c);return this};c.error=function(c){a&&a.error(c);return this};
c.end=function(){a&&a.end();return this};c.emitEvent=function(c){a&&a.emitEvent(c);return this};return c.setName("emitter")}})();var u={},w="title *inlets *outlets prepare process tune *handle".split(" "),E={},R="label default hidden cold readonly allow accept adapt tune show *handle".split(" "),c=["label","tune","show","*handle"],g={},ca=["prepare","size","first","always"],D={},W=["prepare","show","edit"],X={},O={},Y={},Z={},S={},aa={"network/add-patch":["patch"]},B=F(aa),U=A(aa,B,"network",f);B["network/add-patch"].onValue(function(a){U.plug(a.events)});
var P;l.prototype.render=function(a,c,g){a=Array.isArray(a)?a:[a];c=Array.isArray(c)?c:[c];for(var d=0,e=a.length,f;d<e;d++)for(var h=0,b=c.length,t;h<b;h++)f=a[d],t=c[h],S[f]||y(this,"patch","Renderer '"+f+"' is not registered"),this.renderQueue.emit({alias:f,target:t,config:g});return this};l.prototype.addNode=function(a,c,g,e){var f=this,b=g?g:d(c)?c||{}:{},t=d(c)?void 0:c;t&&(b.title=t);c=c&&d(c)?g:e;return new h(a,this,b,c,function(a){f.events.plug(a.events);f.event["patch/add-node"].emit(a);
a.turnOn()})};l.prototype.removeNode=function(a){a.turnOff();this.event["patch/remove-node"].emit(a);this.events.unplug(a.events);return this};l.prototype.open=function(a){this.event["patch/open"].emit(a);return this};l.prototype.close=function(){this.event["patch/close"].emit();return this};l.prototype.inputs=function(a){this.event["patch/set-inputs"].emit(a);return this};l.prototype.outputs=function(a){this.event["patch/set-outputs"].emit(a);return this};l.prototype.project=function(a){this.projections.emit(a);
return this};l.prototype.moveCanvas=function(a,c){this.event["patch/move-canvas"].emit([a,c]);return this};l.prototype.resizeCanvas=function(a,c){this.event["patch/resize-canvas"].emit([a,c]);return this};h.prototype.turnOn=function(){this.event["node/turn-on"].emit();return this};h.prototype.turnOff=function(){this.event["node/turn-off"].emit();return this};h.prototype.addInlet=function(a,c,g,e,f){var h=e?e:d(g)?g||{}:{},b=d(g)?void 0:g;b&&(h.label=b);g=g&&d(g)?e:f;a=new p(a,this,c,h,g);this.events.plug(a.events);
this.event["node/add-inlet"].emit(a);a.toDefault();return a};h.prototype.addOutlet=function(a,c,g,e,f){var h=e?e:d(g)?g||{}:{},b=d(g)?void 0:g;b&&(h.label=b);g=g&&d(g)?e:f;a=new r(a,this,c,h,g);this.events.plug(a.events);this.event["node/add-outlet"].emit(a);a.toDefault();return a};h.prototype.removeInlet=function(a){this.event["node/remove-inlet"].emit(a);this.events.unplug(a.events);return this};h.prototype.removeOutlet=function(a){this.event["node/remove-outlet"].emit(a);this.events.unplug(a.events);
return this};h.prototype.move=function(a,c){this.event["node/move"].emit([a,c]);return this};h.prototype.configure=function(a){this.event["node/configure"].emit(a);return this};p.prototype.receive=function(a){this.value.plug(b.constant(a));return this};p.prototype.stream=function(a){this.value.plug(a);return this};p.prototype.toDefault=function(){t(this.def.default)&&(this.def.default instanceof b.Stream?this.stream(this.def.default):this.receive(this.def.default));return this};p.prototype.allows=
function(a){if("core/any"===this.type||a.type===this.type)return!0;if(!this.def.allow&&a.type!==this.type)return!1;if(this.def.allow){var c=!1;this.def.allow.forEach(function(g){a.type===g&&(c=!0)});return c}return!0};r.prototype.connect=function(a){a.allows(this)||L(this,"outlet","Outlet of type '"+this.type+"' is not allowed to connect to inlet of type '"+a.type+"'");var c=new e(this,a);this.events.plug(c.events);this.value.onValue(c.receiver);this.event["outlet/connect"].emit({link:c,inlet:a});
return c};r.prototype.disconnect=function(a){this.event["outlet/disconnect"].emit(a);this.value.offValue(a.receiver);this.events.unplug(a.events);return this};r.prototype.send=function(a){this.value.plug(b.constant(a));return this};r.prototype.stream=function(a){this.value.plug(a);return this};r.prototype.toDefault=function(){t(this.def.default)&&(this.def.default instanceof b.Stream?this.stream(this.def.default):this.send(this.def.default));return this};e.prototype.pass=function(a){this.value.emit(a);
return this};e.prototype.enable=function(){this.event["link/enable"].emit();return this};e.prototype.disable=function(){this.event["link/disable"].emit();return this};e.prototype.disconnect=function(){this.outlet.disconnect(this);return this};V("core/basic",{});V("core/reference",{});x("core/any",{});var I={patch:function(a){return"[ Patch"+(a.name?" '"+a.name+"'":" <Unnamed>")+" ]"},node:function(a){return"[ Node ("+a.type+")"+(a.def?a.def.title?" '"+a.def.title+"'":" <Untitled>":" <Unprepared>")+
" #"+a.id+" ]"},outlet:function(a){return"[ Outlet ("+a.type+")"+(a.alias?" '"+a.alias+"'":" <Unaliased>")+(a.def?a.def.label?" '"+a.def.label+"'":" <Unlabeled>":" <Unprepared>")+" #"+a.id+" ]"},inlet:function(a){return"[ Inlet ("+a.type+")"+(a.alias?" '"+a.alias+"'":" <Unaliased>")+(a.def?a.def.label?" '"+a.def.label+"'":" <Unlabeled>":" <Unprepared>")+" #"+a.id+(a.def.hidden?" (hidden)":"")+(a.def.cold?" (cold)":"")+" ]"},link:function(a){return"[ Link ("+a.type+") '"+a.name+"' #"+a.id+" "+I.outlet(a.outlet)+
" -> "+I.inlet(a.inlet)+" ]"}};return{VERSION:"v2.1.1",_:{Patch:l,Node:h,Inlet:p,Outlet:r,Link:e},unit:z,not:function(a){return!a},event:B,events:U,addPatch:function(a,c,g){return k(a,c).open(g)},addClosedPatch:k,renderNext:function(a,c,g){P||(P=q());P.emit({aliases:a,targets:c,config:g})},stopRendering:function(){P&&(P.end(),P=null)},nodetype:V,channeltype:x,nodedescription:function(a,c){X[a]=c},renderer:function(a,c){S[a]=c},styles:O,style:function(a,c,g){O[a]||(O[a]={});O[a][c]=g},noderenderer:function(a,
c,d){u[a]||y(null,"network","Node type '"+a+"' is not registered");g[a]||(g[a]={});g[a][c]=d},channelrenderer:function(a,c,g){E[a]||y(null,"network","Channel type '"+a+"' is not registered");D[a]||(D[a]={});D[a][c]=g},toolkiticon:function(a,c){Z[a]=c},nodetypeicon:function(a,c){Y[a]=c},"import":{},"export":{},allNodeTypes:u,allChannelTypes:E,allNodeRenderers:g,allChannelRenderers:D,allNodeDescriptions:X,allNodeTypeIcons:Y,allToolkitIcons:Z,getStyle:function(a,c){a||y(null,"network","Unknown style requested: '"+
a+"'");O[a]||y(null,"network","Style '"+a+"' is not registered");var g=O[a][c];g||y(null,"network","Style '"+a+"' has no definition for '"+c+"' renderer");return g},reportError:L,reportSystemError:y,short_uid:C,stringify:I,autoStringify:function(a){return a instanceof l?I.patch(a):a instanceof h?I.node(a):a instanceof p?I.inlet(a):a instanceof r?I.outlet(a):a instanceof e?I.link(a):"<?> "+a}}}();"function"===typeof define&&define.amd?(define([],function(){return f}),m.Rpd=f):"object"===typeof module&&
"object"===typeof exports?(module.exports=f,f.Rpd=f):m.Rpd=f})(this);var d3_tiny=function(){function m(f,b,q){for(var k="function"===typeof b?b:function(){return b},l=f.selection,h=0,p=l.length;h<p;h++)q(l[h],k.bind(l[h])(h));return f}function b(f,b,q){b=b||document;selection="string"===typeof f?q?Array.prototype.slice.call(b.querySelectorAll(f),0):[b.querySelector(f)]:f instanceof Node?[f]:Array.isArray(f)?f:[f];this.namespace=1===selection.length&&selection[0]?selection[0].namespaceURI:null;this.selection=selection}b.prototype.empty=function(){return 1===this.selection.length&&
!this.selection[0]||!this.selection.length?!0:!1};b.prototype.attr=function(f,b){return"undefined"===typeof b&&1===this.selection.length?this.selection[0].getAttribute(f):m(this,b,function(b,k){b.setAttributeNS(null,f,k)})};b.prototype.property=function(f,b){return"undefined"===typeof b&&1===this.selection.length?this.selection[0][f]:m(this,b,function(b,k){b[f]=k})};b.prototype.style=function(f,b){"-"===f[0]&&(f=f.slice(1));f=f.replace(/-([a-z])/g,function(f){return f[1].toUpperCase()});return m(this,
b,function(b,k){b.style[f]=k})};b.prototype.text=function(f){return"undefined"===typeof f&&1===this.selection.length?this.selection[0].textContent||this.selection[0].innerText:m(this,f,function(f,b){f.innerText=f.textContent=b})};b.prototype.classed=function(f,b){return"object"===typeof f?m(this,Object.keys(f),function(b,k){for(var l=0,h=k.length;l<h;l++)b.classList.toggle(k[l],f[k[l]])}):m(this,b,function(b,k){b.classList.toggle(f,k)})};b.prototype.select=function(f){return new b(f,this.selection[0])};
b.prototype.selectAll=function(f){return new b(f,this.selection[0],!0)};b.prototype.append=function(f){var z=[];m(this,"string"===typeof f?document.createElementNS(this.namespace,f):f,function(b,f){b.appendChild(f);z.push(f)});return new b(z)};b.prototype.remove=function(){return m(this,function(){return null},function(b){b.parentElement.removeChild(b)})};b.prototype.node=function(b){return this.selection[b||0]};b.prototype.parent=function(){return new b(this.selection.length?this.selection[0].parentNode:
[])};b.prototype.on=function(b,z){return m(this,function(){return z},function(q,k){q.addEventListener(b,k)})};b.prototype.data=function(b){return b?m(this,b,function(b,f){b.__data__=f}):this.node().__data__};b.prototype.call=function(b){b(this);return this};return{ns:{prefix:{svg:"http://www.w3.org/2000/svg",html:"http://www.w3.org/1999/xhtml"}},select:function(f,m){return new b(f,m)},selectAll:function(f,m){return new b(f,m,!0)}}}();(function(m){var b=m.Rpd;"undefined"===typeof b&&"undefined"!==typeof require&&(b=require("rpd"));b.Render=function(){function f(d){this.nodeRects=[];this.edgePadding=d.edgePadding||{horizontal:30,vertical:20};this.boxPadding=d.boxPadding||{horizontal:20,vertical:30}}function m(d,b){this.canvas=d;this.style=b}function q(d,b){this.link=d;this.style=b;this.element=this.styledLink=null}function k(){this.vlinks=[]}function l(d){d.stopPropagation();return d}function h(d){return{x:d.clientX,y:d.clientY}}
function p(d,e,f,h){Kefir.fromEvents(d,"click").map(l).map(r(h||!1)).scan(b.not).onValue(function(d){d?e():f()})}var r=b.unit,e=d3_tiny||e;f.DEFAULT_LIMITS=[1E3,1E3];f.prototype.nextPosition=function(d,b,e){e=e||f.DEFAULT_LIMITS;d=this.nodeRects;var h=this.boxPadding,k=this.edgePadding,l=b.width;b=b.height;var p=d.length?d[d.length-1]:null,p={x:p?p.x:k.horizontal,y:p?p.y+p.height+h.vertical:k.vertical,width:l,height:b};p.y+b+k.vertical>e.height&&(p.x=p.x+l+h.horizontal,p.y=k.vertical);d.push(p);return{x:p.x,
y:p.y}};m.prototype.add=function(d,b){var e=this.canvas,f=this.style,p=b.start,k=b.end,r=b.drag;Kefir.fromEvents(d.node(),"mousedown").map(h).map(f.getLocalPos).flatMap(function(b){var t=p(),r=b.x-t.x,m=b.y-t.y;b=Kefir.fromEvents(e.node(),"mousemove").map(l).takeUntilBy(Kefir.merge([Kefir.fromEvents(e.node(),"mouseup"),Kefir.fromEvents(d.node(),"mouseup")])).map(h).map(f.getLocalPos).map(function(d){return{x:d.x-r,y:d.y-m}}).toProperty(function(){return t});b.last().onValue(k);return b}).onValue(r)};
q.prototype.construct=function(d){if(this.styledLink)throw Error("VLink is already constructed");this.styledLink=d=this.style.createLink(this.link);this.element=e.select(d.element);return this};q.prototype.rotate=function(d,b,e,f){var h=this.style;d=h.getLocalPos({x:d,y:b});e=h.getLocalPos({x:e,y:f});this.styledLink.rotate(d.x,d.y,e.x,e.y);return this};q.prototype.rotateI=function(d,b,e){var f=this.style.getInletPos(e);return this.rotate(d,b,f.x,e.y)};q.prototype.rotateO=function(d,b,e){d=this.style.getOutletPos(d);
return this.rotate(d.x,d.y,b,e)};q.prototype.rotateOI=function(d,b){var e=this.style,f=e.getOutletPos(d),e=e.getInletPos(b);return this.rotate(f.x,f.y,e.x,e.y)};q.prototype.update=function(){if(this.link){var d=this.link;this.rotateOI(d.outlet,d.inlet);return this}};q.prototype.appendTo=function(d){d.append(this.element.node());return this};q.prototype.removeFrom=function(d){this.element.remove();return this};q.prototype.noPointerEvents=function(){this.styledLink.noPointerEvents&&this.styledLink.noPointerEvents();
return this};q.prototype.listenForClicks=function(){var d=this.link;p(this.element.node(),function(){d.enable()},function(){d.disable()});return this};q.prototype.enable=function(){this.element.classed("rpd-disabled",!1)};q.prototype.disable=function(){this.element.classed("rpd-disabled",!0)};q.prototype.get=function(){return this.link};q.prototype.getElement=function(){return this.element.node()};k.prototype.clear=function(){this.vlinks=[]};k.prototype.add=function(d){this.vlinks.push(d);return d};
k.prototype.remove=function(d){this.vlinks=this.vlinks.filter(function(b){return b!==d})};k.prototype.forEach=function(d){this.vlinks.forEach(d)};k.prototype.updateAll=function(){this.forEach(function(d){d.update()})};k.prototype.count=function(){return this.vlinks.length};k.prototype.getLast=function(){return this.count()?this.vlinks[this.vlinks.length-1]:null};var K=function(){var d={};return function(b,e,f){e.classed("rpd-error",!0);d[b]&&clearTimeout(d[b]);d[b]=setTimeout(function(){e.classed("rpd-error",
!1);d[b]=null},f||1)}}(),M=function(){var d={};return function(b,e,f){e.classed("rpd-stale",!1);e.classed("rpd-fresh",!0);d[b]&&clearTimeout(d[b]);d[b]=setTimeout(function(){e.classed("rpd-fresh",!1);e.classed("rpd-stale",!0);d[b]=null},f||1)}}();return{Placing:f,DragAndDrop:m,VLink:q,VLinks:k,mergeConfig:function(d,b){if(d){var e={};Object.keys(b).forEach(function(d){e[d]=b[d]});Object.keys(d).forEach(function(b){e[b]=d[b]});return e}return b},preventDefault:function(d){d.preventDefault();return d},
stopPropagation:l,extractPos:h,addTarget:function(d){return function(b){return{pos:b,target:d}}},addClickSwitch:p,addValueErrorEffect:K,addValueUpdateEffect:M,subscribeUpdates:function(d,b){b&&Object.keys(b).forEach(function(e){(function(b,e){d.event["node/add-inlet"].filter(function(b){return b.alias===e}).onValue(function(e){d.event["node/is-ready"].onValue(function(){b.default&&e.receive("function"===typeof b.default?b.default():b.default);if(b.valueOut)b.valueOut.onValue(function(b){e.receive(b)})})})})(b[e],
e)})},reportErrorsToConsole:function(d){b.events.onError(function(e){if(d.logErrors&&!e.silent){var f;try{f=b.autoStringify(e.subject)}catch(h){f="<Unable-to-Stringify>"}e.system?console.error(Error(e.type+" \u2014 "+e.message+". Subject: "+f)):console.log("Error:",e.type,"\u2014",e.message+". ","Subject: "+f,e.subject)}})}}}()})(this);(function(m){m=m.Rpd;"undefined"===typeof m&&"undefined"!==typeof require&&(m=require("rpd"));m.style("quartz","html",function(b){function f(b){b=b.getBoundingClientRect();return{x:b.left,y:b.top}}var m=m||d3_tiny,q,k={},l={};return{edgePadding:{horizontal:30,vertical:20},boxPadding:{horizontal:20,vertical:30},createCanvas:function(b,f){return{element:m.select(document.createElement("div")).classed("rpd-patch",!0).node()}},createNode:function(f,p,k,e){var l=m.select(document.createElement("table")).attr("class",
"rpd-node");l.append("thead").attr("class","rpd-title").classed("rpd-drag-handle",!0).call(function(b){b.append("tr").attr("class","rpd-remove-button").append("th").text("x")}).call(function(p){p.append("tr").attr("class","rpd-header").append("th").attr("colspan",3).call(function(d){b.showTypes&&d.append("span").attr("class","rpd-type").text(f.type);e&&d.append("span").attr("class","rpd-icon").text(e);d.append("span").attr("class","rpd-name").text(f.def.title||f.type);d.attr("title",k?k+" ("+f.type+
")":f.type)})});l.append("tbody").attr("class","rpd-content").call(function(b){b.append("tr").call(function(b){b.append("td").attr("class","rpd-inlets").append("table").append("tbody").append("div").attr("class","rpd-inlets-target")}).call(function(b){b.append("td").attr("class","rpd-body").append("table").append("tbody").append("tr").append("td").append("div").attr("class","rpd-process-target")}).call(function(b){b.append("td").attr("class","rpd-outlets").append("table").append("tbody").append("div").attr("class",
"rpd-outlets-target")})});return{element:l.node(),size:p.size?{width:p.size.width||70,height:p.size.height||30}:{width:10,height:30}}},createInlet:function(f,p){var l=m.select(document.createElement("tr")).attr("class","rpd-inlet").call(function(e){e.append("td").attr("class","rpd-connector");e.append("td").attr("class","rpd-value-holder").append("span").attr("class","rpd-value");e.append("td").attr("class","rpd-name").text(f.def.label||f.alias);b.showTypes&&e.append("td").attr("class","rpd-type").text(f.type)});
k[f.id]=l.select(".rpd-connector");return{element:l.node()}},createOutlet:function(f,p){var k=m.select(document.createElement("tr")).attr("class","rpd-outlet").call(function(e){e.append("td").attr("class","rpd-connector");e.append("td").attr("class","rpd-value");b.showTypes&&e.append("td").attr("class","rpd-type").text(f.type);e.append("td").attr("class","rpd-name").text(f.def.label||f.alias)});l[f.id]=k.select(".rpd-connector");return{element:k.node()}},createLink:function(b){var f=m.select(document.createElement("span")).attr("class",
"rpd-link").style("position","absolute").style("transform-origin","left top").style("-webkit-transform-origin","left top");return{element:f.node(),rotate:function(b,e,h,k){var d=Math.sqrt((b-h)*(b-h)+(e-k)*(e-k));h=Math.atan2(k-e,h-b);f.style("left",b+"px").style("top",e+"px").style("width",Math.floor(d)+"px").style("transform","rotateZ("+h+"rad)").style("-webkit-transform","rotateZ("+h+"rad)")}}},getInletPos:function(b){b=f(k[b.id].node());return{x:b.x,y:b.y-1}},getOutletPos:function(b){b=f(l[b.id].node());
return{x:b.x,y:b.y-1}},getLocalPos:function(b){if(!q)return b;var k=f(q.node());return{x:b.x-k.x,y:b.y-k.y-1}},onPatchSwitch:function(b,f){q=m.select(f)}}})})(this);(function(m){function b(b){return function(l,m){var x=Q(m,h);r.reportErrorsToConsole(x);var u=k.getStyle(x.style,"html")(x);l=p.select(l).classed("rpd-network",!0).classed("rpd-full-page",x.fullPage);var w,E,R;return{"patch/is-ready":function(c){var g=p.select(document.documentElement);w=p.select(u.createCanvas(b,l).element).classed("rpd-canvas",!0);x.fullPage&&w.style("height",g.property("clientHeight")+"px");x.fullPage&&f(window,document,l,w);w.classed("rpd-style-"+x.style,!0).classed("rpd-values-"+
(x.valuesOnHover?"on-hover":"always-shown"),!0).classed("rpd-show-boxes",x.showBoxes);e.patches[b.id]=w.data({patch:c.patch});e.patchToPlacing[b.id]=new r.Placing(u);e.patchToLinks[b.id]=new H;E=new t(w,u,x);x.nodeMovingAllowed&&(R=new r.DragAndDrop(w,u));Kefir.fromEvents(w.node(),"selectstart").onValue(F)},"patch/open":function(c){(x.closeParent||x.fullPage)&&c.parent&&c.parent.close();K=c.patch;var b=e.patches[c.patch.id];l.append(b.node());e.patchToLinks[c.patch.id].updateAll();if(u.onPatchSwitch)u.onPatchSwitch(K,
b.node())},"patch/close":function(c){K=null;w.remove()},"patch/refer":function(c){var g=e.nodes[c.node.id];g.select(".rpd-node").classed("rpd-patch-reference",!0);g.data().processTarget.text("["+(c.target.name||c.target.id)+"]");Kefir.fromEvents(g.data().processTarget.node(),"click").onValue(function(c,b){return function(){b.open(c)}}(b,c.target))},"patch/move-canvas":function(c){w.style("left",c.position[0]+"px");w.style("top",c.position[1]+"px")},"patch/resize-canvas":function(c){w.style("width",
c.size[0]+"px");w.style("height",c.size[1]+"px")},"patch/add-node":function(c){var b=c.node,f=c.patch,h=c.render,k=p.select(document.createElement("div")).attr("class","rpd-node-box"),l=u.createNode(b,h,M[b.type],d[b.type]),m=k.append(l.element);m.classed("rpd-"+b.type.slice(0,b.type.indexOf("/"))+"-toolkit-node",!0).classed("rpd-"+b.type.replace("/","-"),!0);k.style("z-index",0);e.nodes[b.id]=k.data({inletsTarget:m.select(".rpd-inlets-target"),outletsTarget:m.select(".rpd-outlets-target"),processTarget:m.select(".rpd-process-target"),
pos:{x:0,y:0}});var w=new H;e.nodeToLinks[b.id]=w;if(x.nodeMovingAllowed){var q=m.select(".rpd-drag-handle");q.empty()||R.add(q,{start:function(){k.classed("rpd-dragging",!0);k.style("z-index",1);return k.data().pos},drag:function(c){k.style("left",c.x+"px");k.style("top",c.y+"px");w.forEach(function(c){c.element.style("z-index",3);c.update()})},end:function(c){b.move(c.x,c.y);k.classed("rpd-dragging",!1);k.style("z-index",0);w.forEach(function(c){c.element.style("z-index",2)})}})}h.prepare&&h.prepare.bind(b)(e.patches[f.id].node(),
e.patches[K.id].node());h.first&&C(b,h.first.bind(b)(m.select(".rpd-process-target").node(),b.event["node/configure"]));if(h.always)b.event["node/process"].throttle(100).onValue(function(){w.updateAll()});h=e.patches[K.id];l=l.size;c=e.patchToPlacing[c.patch.id].nextPosition(b,l,{width:h.node().offsetWidth,height:h.node().offsetHeight});m.select(".rpd-body").style("min-width",Math.floor(l.width)+"px");m.select(".rpd-body").style("height",Math.floor(l.height)+"px");b.move(c.x,c.y);m=m.select(".rpd-remove-button");
if(!m.empty())Kefir.fromEvents(m.node(),"click").map(N).onValue(function(){f.removeNode(b)});e.patches[f.id].append(k.node())},"patch/remove-node":function(c){c=c.node;var b=e.nodes[c.id];e.nodeToLinks[c.id].forEach(function(c){c.get().disconnect()});b.remove();if(u.onNodeRemove)u.onNodeRemove(c);e.nodes[c.id]=null;e.nodeToLinks[c.id]=null},"node/move":function(c){var b=e.nodes[c.node.id];c=c.position;b.style("left",Math.floor(c[0])+"px");b.style("top",Math.floor(c[1])+"px");b.data().pos={x:c[0],
y:c[1]}},"node/process":function(c){var b=c.node,d=c.render;if(d.always){var f=e.nodes[b.id].data().processTarget.node();d.always.bind(b)(f,c.inlets,c.outlets)}},"node/add-inlet":function(c){var b=c.inlet;if(!b.def.hidden){var d=e.nodes[c.node.id].data().inletsTarget;c=c.render;var f=p.select(u.createInlet(b,c).element);f.classed("rpd-"+b.type.replace("/","-"),!0);f.classed({"rpd-stale":!0,"rpd-readonly":b.def.readonly||!1,"rpd-cold":b.def.cold||!1});var h=null;!b.def.readonly&&c.edit&&(h=new q(b,
c,w,f.select(".rpd-value-holder"),f.select(".rpd-value"),p.select(document.createElement("div"))),f.select(".rpd-value-holder").append(h.editorElm.node()));e.inlets[b.id]=f.data({connector:f.select(".rpd-connector"),value:f.select(".rpd-value"),vlinks:new H,editor:h});b.event["inlet/update"].onError(function(){L(b.id,f,x.effectTime)});E.subscribeInlet(b,f.select(".rpd-connector"));d.append(f.node())}},"node/add-outlet":function(c){var b=c.outlet,d=e.nodes[c.node.id].data().outletsTarget;c=p.select(u.createOutlet(b,
c.render).element);c.classed("rpd-"+b.type.replace("/","-"),!0);c.classed("rpd-stale",!0);e.outlets[b.id]=c.data({connector:c.select(".rpd-connector"),value:c.select(".rpd-value"),vlinks:new H});E.subscribeOutlet(b,c.select(".rpd-connector"));d.append(c.node())},"node/remove-inlet":function(c){c=c.inlet;e.inlets[c.id].data().vlinks.forEach(function(c){c.get().disconnect()});e.inlets[c.id].remove();if(u.onInletRemove)u.onInletRemove(c);e.inlets[c.id]=null},"node/remove-outlet":function(c){c=c.outlet;
e.outlets[c.id].data().vlinks.forEach(function(c){c.get().disconnect()});e.outlets[c.id].remove();if(u.onOutletRemove)u.onOutletRemove(c);e.outlets[c.id]=null},"inlet/update":function(c){var b=c.inlet;if(!b.def.hidden){var d=c.render,f=e.inlets[b.id],h=f.data().value;if(!h.empty()){var k=b.def.show?b.def.show(c.value):c.value;d.show?d.show.bind(b)(h.node(),c.value,k):h.text(k)}y(b.id,f,x.effectTime)}},"outlet/update":function(c){var b=c.outlet,d=c.render,f=e.outlets[b.id],h=f.data().value;if(!h.empty()){var k=
b.def.show?b.def.show(c.value):c.value;d.show?d.show.bind(b)(h.node(),c.value,k):h.text(k)}y(b.id,f,x.effectTime)},"outlet/connect":function(c){c=c.link;var d=c.outlet,f=c.inlet,h=e.inlets[f.id],k=e.outlets[d.id].data(),h=h.data();if(!x.inletAcceptsMultipleLinks&&1===h.vlinks.count())throw Error("Inlet is already connected to a link");h.editor&&h.editor.disable();var l=new G(c,u);l.construct(x.linkWidth).rotateOI(d,f);p.select(l.getElement()).style("z-index",2).classed("rpd-"+f.type.replace("/","-"),
!0).classed("rpd-"+d.type.replace("/","-"),!0);e.links[c.id]=l;k.vlinks.add(l);h.vlinks.add(l);e.nodeToLinks[d.node.id].add(l);d.node.id!==f.node.id&&e.nodeToLinks[f.node.id].add(l);e.patchToLinks[b.id].add(l);l.listenForClicks();l.appendTo(w)},"outlet/disconnect":function(c){c=c.link;var d=e.links[c.id],f=c.outlet,h=c.inlet,k=e.outlets[f.id].data(),l=e.inlets[h.id].data();e.links[c.id]=null;k.vlinks.remove(d);l.vlinks.remove(d);e.nodeToLinks[f.node.id].remove(d);f.node.id!==h.node.id&&e.nodeToLinks[h.node.id].remove(d);
e.patchToLinks[b.id].remove(d);d.removeFrom(w)},"link/enable":function(c){var b=e.inlets[c.link.inlet.id].data();b.editor&&b.editor.disable();e.links[c.link.id].enable()},"link/disable":function(c){e.links[c.link.id].disable()}}}}function f(b,d,e,f){Kefir.fromEvents(b,"resize").map(function(){return b.innerHeight||d.documentElement.clientHeight||d.body.clientHeight}).onValue(function(b){e.style("height",b+"px");f.style("height",b+"px")});e.data({subscribedToResize:!0})}function z(b,d){return Kefir.merge([b.map(l(!0)),
d.map(l(!1))]).toProperty(l(!1))}function q(b,d,f,h,k,m){var p=Kefir.emitter(),q=Kefir.emitter();this.disableEditor=q;this.editorElm=m;this.valueElm=k;m.classed("rpd-value-editor",!0);d.edit.bind(b)(m.node(),b,p).onValue(function(c){b.receive(c)});Kefir.combine([Kefir.merge([Kefir.fromEvents(h.node(),"click").map(N).map(l(!0)),Kefir.fromEvents(f.node(),"click").merge(q).map(l(!1))]).toProperty(l(!1)).skipDuplicates()],[b.event["inlet/update"]]).map(function(c){return{lastValue:c[1],startEditing:c[0],
cancelEditing:!c[0]}}).onValue(function(c){if(c.startEditing){var d=e.inlets[b.id].data();d.link&&d.link.disable();p.emit(c.lastValue);h.classed("rpd-editor-enabled",!0);h.classed("rpd-editor-disabled",!1)}else c.cancelEditing&&(k.classed("rpd-edited",!0),h.classed("rpd-editor-enabled",!1),h.classed("rpd-editor-disabled",!0))});h.classed("rpd-editor-enabled",!1);h.classed("rpd-editor-disabled",!0)}var k=m.Rpd;"undefined"===typeof k&&"undefined"!==typeof require&&(k=require("rpd"));var l=k.unit,h=
{style:"quartz",fullPage:!1,valuesOnHover:!1,showTypes:!1,showBoxes:!1,nodeMovingAllowed:!0,inletAcceptsMultipleLinks:!1,closeParent:!1,logErrors:!0,effectTime:1E3},p=p||d3_tiny,r=k.Render,e={patches:{},nodes:{},inlets:{},outlets:{},links:{},patchToPlacing:{},patchToLinks:{},nodeToLinks:{}},K,M=k.allNodeDescriptions,d=k.allNodeTypeIcons,t=function(){function b(d){return e.inlets[d.id].data().vlinks}function d(f){return function(){return 0<b(f).count()}}function f(b){1===b.count()&&(b=b.getLast().link,
b.outlet.disconnect(b))}function h(b,d){b.forEach(function(b){b.link.outlet.id===d.id&&d.disconnect(b.link)})}function k(b,d,f){this.canvas=b;this.style=d;this.config=f;this.canvasClicks=Kefir.fromEvents(this.canvas.node(),"click");this.inletClicks=Kefir.pool();this.outletClicks=Kefir.pool();this.startLink=Kefir.emitter();this.finishLink=Kefir.emitter();this.doingLink=z(this.startLink,this.finishLink)}k.prototype.subscribeOutlet=function(d,e){var k=this.canvas,c=this.style,g=this.config,m=this.canvasClicks,
q=this.outletClicks,r=this.inletClicks,t=this.startLink,u=this.finishLink,y=this.doingLink;q.plug(Kefir.fromEvents(e.node(),"click").map(A).map(J(d)));Kefir.fromEvents(e.node(),"click").map(N).filterBy(z(q,y)).map(A).onValue(function(e){t.emit();var y=(new G(null,c)).construct(g.linkWidth).rotateO(d,e.x,e.y).noPointerEvents().appendTo(k);p.select(y.getElement()).style("z-index",2).classed("rpd-"+d.type.replace("/","-"),!0);Kefir.fromEvents(k.node(),"mousemove").takeUntilBy(Kefir.merge([r,q.map(l(!1)),
m.map(l(!1))]).take(1).onValue(function(c){if(c){c=c.target;var e=b(c);g.inletAcceptsMultipleLinks?h(e,d):f(e);d.connect(c)}})).map(A).onValue(function(b){y.rotateO(d,b.x,b.y)}).onEnd(function(){y.removeFrom(k);u.emit()})})};k.prototype.subscribeInlet=function(e,k){var m=this.canvas,c=this.style,g=this.config,q=this.canvasClicks,r=this.outletClicks,t=this.inletClicks,u=this.startLink,y=this.finishLink,C=this.doingLink;t.plug(Kefir.fromEvents(k.node(),"click").map(A).map(J(e)));Kefir.fromEvents(k.node(),
"click").map(N).filterBy(z(t,C)).filter(d(e)).onValue(function(d){var k=b(e).getLast().link,z=k.outlet;z.disconnect(k);u.emit();var B=(new G(null,c)).construct(g.linkWidth).rotateO(z,d.x,d.y).noPointerEvents().appendTo(m);p.select(B.getElement()).style("z-index",2).classed("rpd-"+e.type.replace("/","-"),!0).classed("rpd-"+z.type.replace("/","-"),!0);Kefir.fromEvents(m.node(),"mousemove").takeUntilBy(Kefir.merge([t,r.map(l(!1)),q.map(l(!1))]).take(1).onValue(function(c){if(c){c=c.target;var d=b(c);
g.inletAcceptsMultipleLinks?h(d,z):f(d);z.connect(c)}})).map(A).onValue(function(b){B.rotateO(z,b.x,b.y)}).onEnd(function(){B.removeFrom(m);y.emit()})})};return k}();q.prototype.disable=function(){this.valueElm.classed("rpd-edited",!1);this.disableEditor.emit()};var G=r.VLink,H=r.VLinks,Q=r.mergeConfig,F=r.preventDefault,N=r.stopPropagation,A=r.extractPos,J=r.addTarget,L=r.addValueErrorEffect,y=r.addValueUpdateEffect,C=r.subscribeUpdates;k.HtmlRenderer=b;k.renderer("html",b)})(this);
